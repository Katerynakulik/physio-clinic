{% extends "base.html" %}
{% block title %}Physio Schedule{% endblock %}

{% block content %}
<h1 class="mb-4">My Schedule</h1>

<table class="table table-striped align-middle">
  <thead>
    <tr>
      <th>Date</th>
      <th>Time</th>
      <th>Status</th>
      <th>Client / Notes</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    {% for slot in slots %}
      <tr>
        <td>{{ slot.date }}</td>
        <td>{{ slot.start_time }} – {{ slot.end_time }}</td>
        <td>
          {% if slot.status == "booked" %}
            Booked
          {% elif slot.status == "blocked" %}
            Blocked
          {% else %}
            Available
          {% endif %}
        </td>
        <td>
          {% if slot.status == "booked" %}
            <div><strong>{{ slot.client.get_username }}</strong></div>
            {% if slot.client_note %}<div class="text-muted">{{ slot.client_note }}</div>{% endif %}
          {% elif slot.status == "blocked" %}
            {% if slot.blocked_reason %}<div class="text-muted">{{ slot.blocked_reason }}</div>{% endif %}
          {% else %}
            <span class="text-muted">—</span>
          {% endif %}
        </td>
        <td>
          {% if slot.status != "booked" %}
            <form method="post" action="{% url 'block_slot' slot.id %}">
              {% csrf_token %}
              <input name="blocked_reason" class="form-control form-control-sm mb-2"
                     placeholder="Reason (vacation, lunch, holiday...)">
              <button type="submit" class="btn btn-sm btn-outline-danger">
                Block
              </button>
            </form>
          {% else %}
            <span class="text-muted">—</span>
          {% endif %}
        </td>
      </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
